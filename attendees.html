<!DOCTYPE HTML>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="UTF-8">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="styles2.css">
  <link rel="icon" type="image/png" href="images/seal-logo.PNG"/>
  <title>Convivium 2024</title>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7NB4LF8R9Q"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-7NB4LF8R9Q');
</script>

<body>
  <div class="invites-small-screen-text" style="color: white; position: absolute; margin: 30px;">
    <h2> Please use larger device (laptop/PC) to view this page.</h2>
  </div>

  <div class="w3-top" style="z-index: 2;">
  <div class="w3-bar w3-black w3-padding w3-card" style="letter-spacing:4px;">
<!--     <a href="index.html" class="w3-bar-item w3-button">CONVIVIUM 2024</a>-->
<a href="index.html"> 
      <img src="images/convivium-2024-no-bg.PNG" class="logo-img">
   </a>
    <div class="w3-right">
      <a href="home.html" class="w3-bar-item w3-button nav-button">Details</a>
      <a href="registration.html" class="w3-bar-item w3-button nav-button">Registration</a>
      <a href="faq.html" class="w3-bar-item w3-button nav-button">FAQ</a>
    </div>
  </div>
</div>

  <div class="invites-body">
  <img id= "convivium-logo-img" src="images/convivium-2024-no-bg.PNG" class="center-img">

<div  class="reg-form w3-display-container w3-round-xlarge" >
  <form id="emailSubmit" class="registration-form" style="text-align: center;">
  <div id="email-message" class="email-val-message" style="width:100px;"></div>
    <label for="email" style="color: white; float: left;">Email address</label><br>
    <input type="email" id="email" name="email" placeholder="Your Minerva University email address..." required><br><br>
    <br><input type="submit" id="sub">
  </form></div>

 <div class="invites-grid">
  <div class="header1">
      <p id="title1" class="invites-title1" style="margin-right: 10%; margin-left: 10%;"></p> 
      <p id="title2" class="invites-title2" style="margin-right: 10%; margin-left: 10%;"></p> <br><br>
  </div>
  <div class="names1">
    <div id="wrapper-scroll-m19" class="wrapper-scroll" style="display: none;"> 
    <div class="scrolling-words-container">
      <div class="scrolling-words-box">
        <ul class="scroll-list m19">
          <li id="m19-1" class="scroll-name"></li>
          <li id="m19-2" class="scroll-name"></li>
          <li id="m19-3" class="scroll-name"></li>
          <li id="m19-4" class="scroll-name"></li>
          <li id="m19-5" class="scroll-name"></li>
          <li id="m19-6" class="scroll-name"></li>
          <li id="m19-7" class="scroll-name"></li>
          <li id="m19-8" class="scroll-name"></li>
          <li id="m19-9" class="scroll-name"></li>
          <li id="m19-10" class="scroll-name"></li>
          <li id="m19-11" class="scroll-name"></li>
        </ul>
      </div>
    </div>
    <span style="color: #5f6368; float: right;">from M19</span>
    </div>
  </div>
  <div class="names2">
    <div id="wrapper-scroll-m20" class="wrapper-scroll" style="display: none;"> 
    <div class="scrolling-words-container">
      <div class="scrolling-words-box">
        <ul class="scroll-list m20">
          <li id="m20-1" class="scroll-name"></li>
          <li id="m20-2" class="scroll-name"></li>
          <li id="m20-3" class="scroll-name"></li>
          <li id="m20-4" class="scroll-name"></li>
          <li id="m20-5" class="scroll-name"></li>
          <li id="m20-6" class="scroll-name"></li>
          <li id="m20-7" class="scroll-name"></li>
          <li id="m20-8" class="scroll-name"></li>
          <li id="m20-9" class="scroll-name"></li>
          <li id="m20-10" class="scroll-name"></li>
          <li id="m20-11" class="scroll-name"></li>
        </ul>
      </div>
    </div>
    <span style="color: #5f6368; float: right;">from M20</span>
    </div>
  </div>
  <div class="names3">
        <div id="wrapper-scroll-m21" class="wrapper-scroll" style="display: none;"> 
    <div class="scrolling-words-container">
      <div class="scrolling-words-box">
        <ul class="scroll-list m21">
          <li id="m21-1" class="scroll-name"></li>
          <li id="m21-2" class="scroll-name"></li>
          <li id="m21-3" class="scroll-name"></li>
          <li id="m21-4" class="scroll-name"></li>
          <li id="m21-5" class="scroll-name"></li>
          <li id="m21-6" class="scroll-name"></li>
          <li id="m21-7" class="scroll-name"></li>
          <li id="m21-8" class="scroll-name"></li>
          <li id="m21-9" class="scroll-name"></li>
          <li id="m21-10" class="scroll-name"></li>
          <li id="m21-11" class="scroll-name"></li>
        </ul>
      </div>
    </div>
    <span style="color: #5f6368; float: right;">from M21</span>
    </div>
  </div>
  <div class="names4">
        <div id="wrapper-scroll-m22" class="wrapper-scroll" style="display: none;"> 
    <div class="scrolling-words-container">
      <div class="scrolling-words-box">
        <ul class="scroll-list m22">
          <li id="m22-1" class="scroll-name"></li>
          <li id="m22-2" class="scroll-name"></li>
          <li id="m22-3" class="scroll-name"></li>
          <li id="m22-4" class="scroll-name"></li>
          <li id="m22-5" class="scroll-name"></li>
          <li id="m22-6" class="scroll-name"></li>
          <li id="m22-7" class="scroll-name"></li>
          <li id="m22-8" class="scroll-name"></li>
          <li id="m22-9" class="scroll-name"></li>
          <li id="m22-10" class="scroll-name"></li>
          <li id="m22-11" class="scroll-name"></li>
        </ul>
      </div>
    </div>
    <span style="color: #5f6368; float: right;">from M22</span>
    </div>
  </div>
  <div class="names5">
    <div id="wrapper-scroll-m23" class="wrapper-scroll" style="display: none;"> 
    <div class="scrolling-words-container">
      <div class="scrolling-words-box">
        <ul class="scroll-list m23">
          <li id="m23-1" class="scroll-name"></li>
          <li id="m23-2" class="scroll-name"></li>
          <li id="m23-3" class="scroll-name"></li>
          <li id="m23-4" class="scroll-name"></li>
          <li id="m23-5" class="scroll-name"></li>
          <li id="m23-6" class="scroll-name"></li>
          <li id="m23-7" class="scroll-name"></li>
          <li id="m23-8" class="scroll-name"></li>
          <li id="m23-9" class="scroll-name"></li>
          <li id="m23-10" class="scroll-name"></li>
          <li id="m23-11" class="scroll-name"></li>
        </ul>
      </div>
    </div>
    <span style="color: #5f6368; float: right;">from M23</span>
    </div>
  </div>
  
  <div class="footer1"></div>

  <div class="footer2" id="invite-form" style="display: none;">
    
<div class="reg-form w3-display-container w3-black-form w3-round-xlarge">
  <h5 id="msg"></h5>

  <h5 id="formTitle1" style="color:white;"> Send personalized invite to your friend to join Convivium 2024</h5>
  <p id="formTitle2" style="color:white;"> Once you submit this form, we will send an invitation email to your friend with your personalized notes, inviting them to register for the event.</p>

  <form id="inviteForm" class="registration-form">
    <label for="friendName">Your Friend's Name</label><br>
    <input type="text" id="friendName" name="friendName" placeholder="Your friend's first name..." required><br><br>

    <label for="friendEmail">Your Friend's Minerva Email Address</label><br>
    <input type="email" id="friendEmail" name="friendEmail" placeholder="Your friend's Minerva University email address..." required><br><br>

    <label for="message">Add a personalized message to your invite.</label><br>
    <textarea rows="5" cols="60"  id="message" name="message" placeholder="Please specify your financial needs..."></textarea>

    <br><input type="submit" id="subInvite">
  </form>

</div>
  </div>

  <div class='details1'>
    <p id="see-details" class="invites-title3" style="display: none;"> And here is the full list of participants so far... </p> 
  </div>

  <div id="col1" class="col1" style="display: none;">
    <div class="class-names-container">
  <details class='summary-box' open>
  <summary>M19s</summary>
      <div id="m19-class-list" class="class-list">
      </div>
    </details>
    </div>
  </div>
  <div id="col2" class="col2"  style="display: none;">
        <div class="class-names-container">
  <details class='summary-box' open>
  <summary>M20s</summary>
      <div id="m20-class-list" class="class-list">
      </div>
    </details>
    </div>
  </div>
  <div id="col3"  class="col3"  style="display: none;">
        <div class="class-names-container">
  <details class='summary-box' open>
  <summary>M21s</summary>
      <div id="m21-class-list" class="class-list">
      </div>
    </details>
    </div>
  </div>
  <div id="col4" class="col4"  style="display: none;">
        <div class="class-names-container">
  <details class='summary-box' open>
  <summary>M22s</summary>
      <div id="m22-class-list" class="class-list">
      </div>
    </details>
    </div>
  </div>
  <div id="col5" class="col5"  style="display: none;">
        <div class="class-names-container">
  <details class='summary-box' open>
  <summary>M23s</summary>
      <div id="m23-class-list" class="class-list">
      </div>
    </details>
    </div>
  </div>
  </div>

  <img src="images/seal-logo.PNG" class="seal-img" id="seal-img">

  <script>

    function addScrollNames(year, list_of_names){
      for (let i = 1; i < 11; i++) {
        current_name = list_of_names[(Math.floor(random(1, list_of_names.length))) - 1]
        if (i==1){
          document.getElementById(year+"-1").innerHTML = current_name;
          document.getElementById(year+"-11").innerHTML = current_name;
        }
          else{
            document.getElementById(year+"-"+i).innerHTML = current_name;
          };
      }
    }

    function random(mn, mx) {
      return Math.random() * (mx - mn) + mn;}

    // let form = document.querySelector("form");
    let form = document.getElementById("emailSubmit");

      let isValidEmail = false;
  document.addEventListener("DOMContentLoaded", function () {
    const emailInput = document.getElementById("email");

    emailInput.addEventListener('input', (e) => {
      e.preventDefault();
      const emailValue = emailInput.value;
      // Regular expression to match the domain after '@'
      const regex = /@(uni\.minerva\.edu)$/;

      if (regex.test(emailValue)) {
        isValidEmail = true;
      } else {
        isValidEmail = false;
      }
    })
  })

    form.addEventListener('submit', (e) => {
      if (!isValidEmail) {
      e.preventDefault();
      alert('Please enter a valid Minerva University-domain address before submitting.')
    } else {
      e.preventDefault();
      // The preventDefault() method stops the form from submitting and prevents the page from refreshing.
      document.querySelector("#sub").value = "Submitting...";

      const sheetID = '1Pm7NFskQvtmCNOpldwspJvbyKJRR42W-CByehv0E_8Q';
      const base = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?`;
      const sheetName = 'Sheet1';

      const query = encodeURIComponent('SELECT * ');
      const url = `${base}&sheet=${sheetName}&tq=${query}&headers=1`;
      const data = [];

      init()

    function init(){
      fetch(url)
      .then(res => res.text())
      .then(rep => {
        // console.log(rep)
        const colz = [];
        const jsData =  JSON.parse(rep.substr(47).slice(0,-2));
        jsData.table.cols.forEach((heading) => {
          if(heading.label) {
            colz.push(heading.label.toLowerCase().replace(/\s/g, '' ));
          }
        })
        //console.log(jsData)
        jsData.table.rows.forEach((main) => {
          const row = {};
          colz.forEach((ele, ind) => {
            row[ele] = (main.c[ind] != null) ? main.c[ind].v : '';
          })
          data.push(row);
        })

    emails = [];

    m19_names = [];
    m20_names = [];
    m21_names = [];
    m22_names = [];
    m23_names = [];

    m19_full_names = [];
    m20_full_names = [];
    m21_full_names = [];
    m22_full_names = [];
    m23_full_names = [];

    data.forEach((el) =>{
        emails.push(el['email'])
        if (el['year'] == '2019') {
          m19_names.push(el['name'])
          m19_full_names.push(el['name']+" "+el['lname'])
        } if (el['year'] == '2020') {
          m20_names.push(el['name'])
          m20_full_names.push(el['name']+" "+el['lname'])
        } if (el['year'] == '2021') {
          m21_names.push(el['name'])
          m21_full_names.push(el['name']+" "+el['lname'])
        } if (el['year'] == '2022') {
          m22_names.push(el['name'])
          m22_full_names.push(el['name']+" "+el['lname'])
        } if (el['year'] == '2023') {
          m23_names.push(el['name'])
          m23_full_names.push(el['name']+" "+el['lname'])
        }
    })

    displayMessage(emails)
  })
  }

  function displayMessage(email) {
    const emailInput = document.getElementById("email").value;

    userName = "";
    fulluserName = "";
    userEmail = "";

    data.forEach((user) => {
      if(user['email'] == emailInput) {
        userName = user['name']
        fulluserName = user['name'] + " " + user['lname']
        userEmail = user['email']
      }
    })

    addScrollNames('m19', m19_names);
    addScrollNames('m20', m20_names);
    addScrollNames('m21', m21_names);
    addScrollNames('m22', m22_names);
    addScrollNames('m23', m23_names);

    m19_full_names.sort()
    m20_full_names.sort()
    m21_full_names.sort()
    m22_full_names.sort()
    m23_full_names.sort()


    m19_full_names.forEach((name) => {
      document.getElementById("m19-class-list").innerHTML += name + "<br>";
    })
    m20_full_names.forEach((name) => {
      document.getElementById("m20-class-list").innerHTML += name + "<br>";
    })
    m21_full_names.forEach((name) => {
      document.getElementById("m21-class-list").innerHTML += name + "<br>";
    })
    m22_full_names.forEach((name) => {
      document.getElementById("m22-class-list").innerHTML += name + "<br>";
    })
    m23_full_names.forEach((name) => {
      document.getElementById("m23-class-list").innerHTML += name + "<br>";
    })

    // INVITE FORM
    let inviteForm = document.getElementById("inviteForm")
    let isValidFriendEmail = false;
    // document.addEventListener("DOMContentLoaded", function () {
    const friendEmailInput = document.getElementById("friendEmail");

      friendEmailInput.addEventListener('input', (e) => {
        e.preventDefault();
        const friendEmailValue = friendEmailInput.value;
        const required_domain = /@(uni\.minerva\.edu)$/;
        if (required_domain.test(friendEmailValue)) {
          isValidFriendEmail = true;
        } else {
          isValidFriendEmail = false;
        }
      })
    // })
    inviteForm.addEventListener('submit', (e) => {
        if (!isValidFriendEmail) {
        e.preventDefault();
        alert('Please enter a valid Minerva University-domain address before submitting.')
      } else {
        e.preventDefault();
        document.querySelector("#subInvite").value = "Submitting...";

        let inviteData = new FormData(inviteForm);
        inviteData.append('senderName', fulluserName);
        inviteData.append('senderEmail', emailInput);
        // The FormData() method creates a new FormData object that contains the values of all the form fields.
        fetch('https://script.google.com/macros/s/AKfycbxVN1pxbic5Fj72xQK8UItUlq6ic35p8UEaWEffmnXdfb5IpGjMfVnKbfPkiEP3gM2q/exec', {
          method: "POST",
          body: inviteData
        })
        // The fetch() method is used to make a request to the server and retrieve data.
        // This is an example API endpoint. Replace it with the actual URL for the API endpoint you want to use.
        .then(res => res.text())
        // The .then() method is used to handle the response from the server.
        // The response is converted to text using the res.text() method.
        .then(data => {
          document.querySelector("#msg").innerHTML = data;
          document.querySelector("#sub").value = "Submitted"
        })
        .then( event => {
          if (emails.includes(friendEmailInput.value)) {
            document.getElementById("formTitle1").innerHTML = "Your friend already registered!"
          } else {
            document.getElementById("formTitle1").innerHTML = "Your invitation is on the way!"
          }
          document.getElementById("formTitle2").innerHTML = "If you would like to send more invites, please reload this page and submit a new invitiation form."
          document.getElementById("inviteForm").style.display = "none";
        })
      }
    })


    if (userName != "") {
      document.getElementById("title1").innerHTML = "Hello " + userName + "!";
      document.getElementById("title2").innerHTML = "Looks like you already registered for Convivium 2024 - Yuhuu! Now it's time to see which of your friends will be joining you and send personalized invites to those who have not registered yet.";
    } else {
       document.getElementById("title1").innerHTML = "Hello Minervan!";
       document.getElementById("title2").innerHTML = "Take a look at who signed up for Convivium 2024 so far from your friends and head over to <a href='registration.html'>Registration page</a> to submit your participation before October 1, 2023. Don't forget to invite your other friends too!";
    }
    document.getElementById("emailSubmit").style.display = "none";
    document.getElementById("seal-img").style.display = "none";
    document.getElementById("convivium-logo-img").style.display = "none";
    document.getElementById("wrapper-scroll-m19").style.display = "block";
    document.getElementById("wrapper-scroll-m20").style.display = "block";
    document.getElementById("wrapper-scroll-m21").style.display = "block";
    document.getElementById("wrapper-scroll-m22").style.display = "block";
    document.getElementById("wrapper-scroll-m23").style.display = "block";
    document.getElementById("see-details").style.display = "block";
    document.getElementById("invite-form").style.display = "block";
    document.getElementById("col1").style.display = "block";
    document.getElementById("col2").style.display = "block";
    document.getElementById("col3").style.display = "block";
    document.getElementById("col4").style.display = "block";
    document.getElementById("col5").style.display = "block";
   }
   }})

</script>
</div>
</body>
</html>
